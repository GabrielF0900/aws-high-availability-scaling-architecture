# ğŸš€ Cluster Auto-EscalÃ¡vel na AWS - Arquitetura de Alta Disponibilidade

Bem-vindo ao projeto de **Arquitetura de Alta Disponibilidade e Tolerante a Falhas na AWS**! Este documento documenta todo o processo de construÃ§Ã£o de uma infraestrutura cloud robusta, escalÃ¡vel e totalmente automatizada.

---

## ğŸ“‹ Ãndice

1. [IntroduÃ§Ã£o](#introduÃ§Ã£o)
2. [Arquitetura Geral](#arquitetura-geral)
3. [Passo a Passo Completo](#passo-a-passo-completo)
   - [VPC Multi-AZ](#vpc-multi-az)
   - [CriaÃ§Ã£o da AMI (Launch Template)](#criaÃ§Ã£o-da-ami-launch-template)
   - [Application Load Balancer](#application-load-balancer)
   - [Auto Scaling Group](#auto-scaling-group)
   - [Testes e ValidaÃ§Ã£o](#testes-e-validaÃ§Ã£o)
4. [Tecnologias Utilizadas](#tecnologias-utilizadas)
5. [Diagrama de Arquitetura](#diagrama-de-arquitetura)

---

## ğŸ“– IntroduÃ§Ã£o

Este projeto demonstra a criaÃ§Ã£o de uma infraestrutura AWS altamente disponÃ­vel, com capacidade de auto-escala automÃ¡tica. A arquitetura foi projetada para:

âœ… **Distribuir trÃ¡fego** entre mÃºltiplas instÃ¢ncias EC2  
âœ… **Garantir alta disponibilidade** em mÃºltiplas Zonas de Disponibilidade (AZs)  
âœ… **Escalar automaticamente** quando a demanda aumentar  
âœ… **Recuperar automaticamente** de falhas de instÃ¢ncias  
âœ… **Monitorar em tempo real** com CloudWatch  

---

## ğŸ—ï¸ Arquitetura Geral

![Diagrama da Arquitetura de Alta Disponibilidade](assets/31-ArquiteturaDrawio.jpeg)

---

## ğŸ¯ Passo a Passo Completo

### 1ï¸âƒ£ VPC Multi-AZ

#### Passo 1: Console AWS - PÃ¡gina Inicial
ComeÃ§amos pela pÃ¡gina inicial do console da AWS, onde todo o magic acontece!

![AWS Console Initial Page](assets/01-pagina-inicial.jpeg)

#### Passo 2: ConfiguraÃ§Ã£o da VPC
Navegamos atÃ© o recurso de **VPC** e iniciamos a configuraÃ§Ã£o da VPC multi-AZ para alta disponibilidade. Escolhemos a opÃ§Ã£o **"VPC e Muito Mais"** para um setup completo e robusto.

![VPC Configuration Start](assets/02-configuracao-vpc.jpeg)

**ConfiguraÃ§Ãµes aplicadas:**
- **Nome da VPC:** `vpc-cluster-auto-escalavel` (seu nome pode variar)
- **Bloco CIDR:** `10.0.0.0/16` (oferece **65.536 endereÃ§os IP** para toda a VPC - mais que o suficiente!)

#### Passo 3: SeleÃ§Ã£o de AZs
Escolhemos **2 Zonas de Disponibilidade** para criar as subnets. As subnets sÃ£o **ZONAIS**, ou seja, cada uma pertence a uma Ãºnica AZ. Com subnets em mÃºltiplas AZs, garantimos que a VPC seja realmente **Multi-AZ** e tolere falhas de zona inteira!

![Multi-AZ Configuration](assets/03-mais-config-vpc.jpeg)

**Topologia criada:**
- 2 Subnets PÃºblicas (uma por AZ)
- 2 Subnets Privadas (uma por AZ)
- NAT Gateway para acesso Ã  internet das instÃ¢ncias privadas

#### Passo 4: NAT Gateway - Zonal vs Regional
Inicialmente escolhemos NAT Gateway **Regional**, porÃ©m devido aos limites da escola na nuvem, voltamos e escolhemos a opÃ§Ã£o **Zonal**.

![NAT Gateway Configuration](assets/04-outra-config-vpc.jpeg)

O **NAT Gateway** Ã© essencial! Ele permite que as instÃ¢ncias nas subnets privadas faÃ§am:
- âœ… AtualizaÃ§Ãµes de patches
- âœ… Download de pacotes de software
- âœ… ComunicaÃ§Ã£o com serviÃ§os externos

Tudo isso mantendo as instÃ¢ncias **protegidas** dentro da rede privada!

#### Passo 5: VPC Criada com Sucesso! ğŸ‰
E assim, nossa VPC multi-AZ estÃ¡ pronta para receber todas as outras camadas da arquitetura!

![VPC Created Successfully](assets/05-vpc-criada.jpeg)

---

### 2ï¸âƒ£ CriaÃ§Ã£o da AMI (Launch Template)

#### Passo 6: Acessando EC2
Navegamos atÃ© o recurso **EC2** para criar um **modelo de execuÃ§Ã£o** (Launch Template) e uma **imagem AMI** prÃ©-configurada que servirÃ¡ como template para criar novas instÃ¢ncias automaticamente via Auto Scaling.

![EC2 Resource Page](assets/06-pagina-ec2.jpeg)

#### Passo 7: ConfiguraÃ§Ã£o da AMI - Nome e DescriÃ§Ã£o
Iniciamos a configuraÃ§Ã£o do Launch Template, adicionando:
- **Nome:** Um identificador descritivo
- **DescriÃ§Ã£o:** Contexto sobre a instÃ¢ncia
- âœ… **Habilitamos:** "OrientaÃ§Ã£o sobre Auto Scaling" (fundamental!)

![Launch Template Configuration](assets/07-config-AMI.jpeg)

#### Passo 8: Sistema Operacional
Escolhemos **Amazon Linux** como sistema operacional. Ã‰ leve, seguro e altamente otimizado para a AWS!

![OS Selection](assets/08-mais-config-AMI.jpeg)

#### Passo 9: Tipo de InstÃ¢ncia
Selecionamos **t2.micro** - perfeito para aprendizado e possui acesso Ã  **free tier** da AWS. Para produÃ§Ã£o, vocÃª escalaria para tipos maiores conforme a demanda.

![Instance Type t2.micro](assets/09-t2-AMI.jpeg)

#### Passo 10: Security Group da AMI
Criamos um **Security Group** especÃ­fico para servir como camada de seguranÃ§a a nÃ­vel de instÃ¢ncia. Este SG permite:
- TrÃ¡fego HTTP/HTTPS do ALB
- SSH apenas da Bastion Host
- Todas as respostas saem livremente

![Security Group Configuration](assets/10-SG-AMI.jpeg)

#### Passo 11: Script de User Data
Aqui vem o segredo da prÃ©-configuraÃ§Ã£o! Adicionamos um script que executa automaticamente quando a instÃ¢ncia inicia:

```bash
#!/bin/bash
# Atualizar pacotes do sistema
yum update -y

# Instalar Apache Web Server
yum install httpd -y

# Iniciar serviÃ§o HTTP
systemctl start httpd
systemctl enable httpd

# Criar pÃ¡gina HTML personalizada
INSTANCE_ID=$(ec2-metadata --instance-id | cut -d " " -f 2)
cat > /var/www/html/index.html <<EOF
<!DOCTYPE html>
<html>
<head>
    <title>Cluster Auto-EscalÃ¡vel</title>
</head>
<body>
    <h1>Bem-vindo ao Cluster Auto-EscalÃ¡vel!</h1>
    <p>InstÃ¢ncia ID: $INSTANCE_ID</p>
    <p>Status: Operacional âœ…</p>
</body>
</html>
EOF
```

Este script garante que **toda nova instÃ¢ncia criada pelo Auto Scaling jÃ¡ inicia com o Apache rodando**!

![User Data Script](assets/11-Data-AMI.jpeg)

#### Passo 12: AMI Criada com Sucesso! ğŸŠ
O Launch Template estÃ¡ pronto e serÃ¡ usado pelo Auto Scaling Group para provisionar novas instÃ¢ncias automaticamente!

![AMI Created Successfully](assets/12-AMI-Criada.jpeg)

---

### 3ï¸âƒ£ Application Load Balancer

#### Passo 13: Selecionando ALB
Navegamos atÃ© **Load Balancer** e escolhemos o **Application Load Balancer (ALB)**. Este Ã© o "inteligente" do lote - ele analisa cada requisiÃ§Ã£o e sabe exatamente qual instÃ¢ncia Ã© a mais apropriada para atendÃª-la!

![Load Balancer Selection](assets/13-ALB.jpeg)

**Por que ALB?**
- ğŸ§  Compreende protocolos HTTP/HTTPS
- ğŸ¯ Pode rotear por caminho, host, ou porta
- âš¡ DistribuiÃ§Ã£o inteligente de carga
- ğŸ“Š MÃ©tricas detalhadas

#### Passo 14: ConfiguraÃ§Ã£o Inicial do ALB
Iniciamos a configuraÃ§Ã£o:
- **Nome:** Identificador do balanceador
- âœ… **Voltado para Internet:** SIM! Ele recebe requisiÃ§Ãµes da internet
- **VPC:** AtribuÃ­mos Ã  VPC que criamos
- **Esquema:** Internet-facing (pÃºblico)

![ALB Initial Configuration](assets/14-config-ALB.jpeg)

#### Passo 15: SeleÃ§Ã£o de Subnets PÃºblicas
Aqui estÃ¡ o ponto crucial: colocamos o ALB nas **subnets pÃºblicas**! Por quÃª?

- ğŸŒ Precisa receber trÃ¡fego da internet
- ğŸ”€ Precisa distribuir para as instÃ¢ncias privadas
- ğŸ›¡ï¸ JÃ¡ estÃ¡ protegido pelo Security Group
- ğŸ¢ Ã‰ o gateway entre internet e sua infraestrutura

![Subnet Selection](assets/15-mais-config-ALB.jpeg)

#### Passo 16: Security Group do ALB
Criamos um Security Group especÃ­fico para o ALB que:
- âœ… **Aceita:** TrÃ¡fego HTTP (80) e HTTPS (443) de qualquer lugar (0.0.0.0/0)
- âŒ **Nega:** Tudo o mais
- ğŸ“¤ **Permite saÃ­da:** Para qualquer destino (necessÃ¡rio para verificar instÃ¢ncias)

![ALB Security Group](assets/16-SG-ALB-Criado.jpeg)

#### Passo 17: Criando Target Group
Aqui definimos os **destinos** do ALB - as instÃ¢ncias EC2 que vÃ£o receber o trÃ¡fego:

- **Tipo de Alvo:** InstÃ¢ncias EC2
- **Protocolo:** HTTP (porta 80)
- **VPC:** Nossa VPC multi-AZ
- **Health Check:** Enabled (verificaÃ§Ã£o automÃ¡tica de saÃºde)

![Target Group Creation](assets/17-Grupo-De-Destino.jpeg)

#### Passo 18: Target Group Criado
O grupo de destino estÃ¡ pronto. Cada vez que uma requisiÃ§Ã£o chega ao ALB, ele escolhe uma instÃ¢ncia deste grupo baseado em:
- ğŸ¥ SaÃºde da instÃ¢ncia
- âš–ï¸ Menor nÃºmero de conexÃµes ativas
- ğŸ¯ Algoritmo de round-robin com ponderaÃ§Ã£o

![Target Group Created](assets/18-Grupo-De-Destino-Criado.jpeg)

#### Passo 19: Application Load Balancer Criado! ğŸ‰
O ALB estÃ¡ operacional! Ele agora tem um DNS pÃºblico que pode ser usado para acessar suas aplicaÃ§Ãµes. PorÃ©m, ainda nÃ£o temos instÃ¢ncias - o Auto Scaling criarÃ¡ essas para nÃ³s!

![ALB Created Successfully](assets/19-ALB-Criado.jpeg)

---

### 4ï¸âƒ£ Auto Scaling Group

#### Passo 20: Iniciando ConfiguraÃ§Ã£o do ASG
Agora chegamos ao **"herÃ³i invisÃ­vel"** da arquitetura: o **Auto Scaling Group (ASG)**! Este Ã© nosso "socorrista" automÃ¡tico!

![ASG Configuration Start](assets/20-config-ASG.jpeg)

**ConfiguraÃ§Ãµes aplicadas:**
- **Nome:** Identificador descritivo
- **Launch Template:** Aquele que criamos com o Apache prÃ©-configurado
- **VersÃ£o:** Latest (sempre usar a mais recente)

#### Passo 21: Subnets Privadas
Colocamos o ASG para criar instÃ¢ncias nas **2 subnets privadas** (uma por AZ):

![ASG Subnet Selection](assets/21-ASG-sub-redes.jpeg)

**Por que subnets privadas?**
- ğŸ”’ Mais seguras (sem acesso direto da internet)
- ğŸ›¡ï¸ Protegidas pelo ALB na frente
- ğŸ”„ O ALB roteia o trÃ¡fego para elas
- ğŸ“Š Melhor compliance e seguranÃ§a

**OpÃ§Ã£o de Balanceamento:** "Melhor esforÃ§o equilibrado" para distribuiÃ§Ã£o inteligente entre AZs!

#### Passo 22: Health Check - O Enfermeiro da Infraestrutura ğŸ¥
Ativamos o **Health Check**, um recurso crÃ­tico que:

1. âœ… Verifica a integridade de **cada instÃ¢ncia**
2. ğŸš¨ Se detectar falha:
   - Avisa ao **ALB** para parar de enviar trÃ¡fego
   - Avisa ao **ASG** para remover a instÃ¢ncia
   - Cria **automaticamente uma nova** baseada na AMI
3. âš¡ **Durante a transiÃ§Ã£o:** A segunda instÃ¢ncia recebe todo o trÃ¡fego!

![Health Check Configuration](assets/22-health-cheack-ASG.jpeg)

Isso Ã© **tolerÃ¢ncia a falhas automÃ¡tica**! ğŸ¯

#### Passo 23: PolÃ­tica de Escalabilidade
Este Ã© o coraÃ§Ã£o do auto-scaling! Configuramos:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Capacidade de InstÃ¢ncias            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MÃ­nima:   2 instÃ¢ncias                  â”‚
â”‚ Desejada: 2 instÃ¢ncias                  â”‚
â”‚ MÃ¡xima:   4 instÃ¢ncias                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**PolÃ­tica de Dimensionamento:** Monitoramento de objetos baseado em **CPU > 70%**

Isso significa:
- ğŸ“‰ CPU abaixo de 70% â†’ MantÃ©m 2 instÃ¢ncias
- ğŸ”¼ CPU ultrapassa 70% â†’ Cria mais instÃ¢ncias automaticamente
- â¬†ï¸ MÃ¡ximo de 4 instÃ¢ncias (proteÃ§Ã£o contra custos altos)

![Scaling Policy](assets/23-ASG-Escalabilidade.jpeg)

#### Passo 24: Auto Scaling Group Criado! ğŸš€
O ASG estÃ¡ vivo! Ele criarÃ¡ automaticamente 2 instÃ¢ncias nas subnets privadas. Essas instÃ¢ncias rodarÃ£o nosso Apache prÃ©-configurado e o ALB comeÃ§arÃ¡ a rotear trÃ¡fego para elas!

![ASG Created Successfully](assets/24-ASG-Criado.jpeg)

---

### 5ï¸âƒ£ Testes e ValidaÃ§Ã£o

#### Passo 25: Bastion Host - O PortÃ£o Seguro ğŸ”‘
Uma instÃ¢ncia EC2 numa subnet pÃºblica que serve como **ponto de acesso seguro** para as instÃ¢ncias em subnets privadas. Nem vocÃª, nem ninguÃ©m, acessa as instÃ¢ncias privadas diretamente - sÃ³ atravÃ©s da Bastion!

![Bastion Host Created](assets/25-ec2-bastion-criado.jpeg)

**Por que Bastion Host?**
- ğŸ”’ Single point of access (auditable)
- ğŸ›¡ï¸ Reduz a superfÃ­cie de ataque
- ğŸ“‹ Logs de todas as conexÃµes
- ğŸ“ Melhor prÃ¡tica de seguranÃ§a

#### Passo 26: Conectando na Bastion Host
Aqui, estabelecemos uma conexÃ£o SSH com a Bastion Host usando nosso par de chaves:

```bash
ssh -i "sua-chave.pem" ec2-user@bastion-public-ip
```

![Bastion Connection Established](assets/26-conectando-na-ec2-bastion.jpeg)

#### Passo 27: Saltando para InstÃ¢ncia Privada
Daqui, configuramos SSH forwarding para acessar a instÃ¢ncia privada:

```bash
ssh -i "sua-chave.pem" -J ec2-user@bastion-ip ec2-user@private-ip
```

A Security Group da instÃ¢ncia privada foi configurada para aceitar SSH **apenas** da Bastion Host!

![Private Instance Connection](assets/27-da-ec2-bastion-para-ec2-private.jpeg)

#### Passo 28: Teste de Stress de CPU - O Momento da Verdade! âš¡

Dentro da SSH da instÃ¢ncia privada, executamos um comando de stress:

```bash
# Instalar ferramenta de stress
sudo amazon-linux-extras install epel-y
sudo yum install stress -y

# Estressar a CPU por 5 minutos
stress --cpu 2 --timeout 300s
```

**E entÃ£o... comeÃ§ou a magia!** ğŸ“Š

As notificaÃ§Ãµes comeÃ§aram a surgir no console da AWS, e a mais importante:

### **"Launching a new EC2 Instance"** ğŸ‰

Isso significa que o Auto Scaling Group detectou que a CPU foi alÃ©m de 70% e **automaticamente iniciou a criaÃ§Ã£o de uma terceira instÃ¢ncia**!

![Scaling Notification](assets/28-instancias-sendo-criadas.jpeg)

#### Passo 29: Novas InstÃ¢ncias Criadas com Sucesso!
Na aba de **InstÃ¢ncias EC2**, podemos ver **3 instÃ¢ncias rodando**:
- 2 instÃ¢ncias iniciais (desejadas)
- 1 nova instÃ¢ncia criada automaticamente pelo teste de stress

Todas rodando nosso Apache, gerenciadas pelo ALB! ğŸš€

![Instances Created](assets/29-instancias-criadas-asg.jpeg)

#### Passo 30: CloudWatch em Tempo Real ğŸ“ˆ
E aqui estÃ¡ a prova final! O **CloudWatch** mostrando:
- ğŸ“Š GrÃ¡ficos de CPU em tempo real
- ğŸ”” NotificaÃ§Ãµes de scaling
- ğŸ“‰ MÃ©tricas de cada instÃ¢ncia
- âš™ï¸ Status do Auto Scaling

Tudo funcionando perfeitamente! O CPU subiu, disparou os alarmes, o Auto Scaling reagiu e uma nova instÃ¢ncia foi criada automaticamente!

![CloudWatch Dashboard](assets/30-Cloudwatch.jpeg)

---

## ğŸ› ï¸ Tecnologias Utilizadas

| Componente | ServiÃ§o AWS | FunÃ§Ã£o |
|-----------|-----------|--------|
| **Rede** | VPC | Rede virtual isolada e multi-AZ |
| **Sub-redes** | Subnets | SegmentaÃ§Ã£o de rede por AZ |
| **NAT Gateway** | NAT Gateway | Acesso Ã  internet para instÃ¢ncias privadas |
| **InstÃ¢ncias** | EC2 | Servidores que rodam a aplicaÃ§Ã£o |
| **Load Balancer** | Application Load Balancer | DistribuiÃ§Ã£o inteligente de trÃ¡fego |
| **Auto Scaling** | Auto Scaling Group | CriaÃ§Ã£o/remoÃ§Ã£o automÃ¡tica de instÃ¢ncias |
| **Monitoramento** | CloudWatch | MÃ©tricas e alarmes em tempo real |
| **SeguranÃ§a** | Security Groups | Firewall a nÃ­vel de instÃ¢ncia |
| **Template** | Launch Template | Modelo prÃ©-configurado para EC2 |

---

## ğŸ“Š Diagrama de Arquitetura

![Arquitetura Completa](assets/31-ArquiteturaDrawio.jpeg)

---

## ğŸ“ LiÃ§Ãµes Aprendidas

âœ… **Multi-AZ Ã© essencial** para alta disponibilidade  
âœ… **ALB Ã© inteligente** e distribui carga eficientemente  
âœ… **Auto Scaling Ã© automÃ¡tico** - cria/remove instÃ¢ncias conforme demanda  
âœ… **Health Check salva vidas** (e infraestruturas!)  
âœ… **Bastion Host Ã© seguranÃ§a** contra acessos nÃ£o autorizados  
âœ… **Subnets privadas** para aplicaÃ§Ã£o, pÃºblicas para acesso  
âœ… **CloudWatch mostra tudo** em tempo real  

---

## ğŸ‰ ConclusÃ£o

VocÃª agora possui uma **arquitetura cloud altamente disponÃ­vel, tolerante a falhas e automaticamente escalÃ¡vel**! 

Este projeto demonstra princÃ­pios fundamentais de:
- â˜ï¸ Cloud Computing
- ğŸ”„ DevOps e IaC (Infrastructure as Code)
- ğŸ“Š Monitoramento e Observabilidade
- ğŸ”’ SeguranÃ§a em Profundidade

**ParabÃ©ns! ğŸ† Seu cluster auto-escalÃ¡vel estÃ¡ vivo e funcionando!**

---

*DocumentaÃ§Ã£o criada em: 28 de dezembro de 2025*  
*Projeto: Cluster Auto-EscalÃ¡vel na AWS*  
*Status: âœ… Em ProduÃ§Ã£o!*
